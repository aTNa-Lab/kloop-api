(this["webpackJsonpkloop-api"]=this["webpackJsonpkloop-api"]||[]).push([[0],{347:function(e,t,a){e.exports=a(669)},352:function(e,t,a){},662:function(e,t,a){},663:function(e){e.exports=JSON.parse("{}")},669:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(18),o=a.n(c),i=(a(352),a(286)),l=a(42),s=a.n(l),u=a(133),d=a(28),m=a(285),p={flex:1,display:"flex",flexDirection:"column",alignItems:"center",paddingTop:"30px",paddingBottom:"30px",paddingLeft:"auto",paddingRight:"auto",borderWidth:2,borderRadius:2,borderColor:"#eeeeee",borderStyle:"dashed",backgroundColor:"#fafafa",color:"#bdbdbd",outline:"none",transition:"border .24s ease-in-out"},f=function(e){var t=Object(n.useCallback)((function(t){t.forEach((function(t){e.handleChange(t),e.handleClick();var a=new FileReader;a.onloadend=function(){e.setImage(a.result)},a.readAsDataURL(t)}))}),[]),a=Object(m.a)({onDrop:t,noClick:!0,noKeyboard:!0,multiple:!0}),c=(a.acceptedFiles,a.getRootProps),o=a.getInputProps,i=a.open;return r.a.createElement("section",{className:"container",style:{width:"100%"}},r.a.createElement("div",c({style:p}),r.a.createElement("input",o()),r.a.createElement("p",null,"Drag 'n' drop some files here, or click to select files"),r.a.createElement("button",{type:"button",onClick:i},"Open File Dialog")))},g=(a(703),a(713)),h=a(717),b=a(714),E=a(716),O=a(704),j=a(278),v=a.n(j),y=function(e){return console.log("GOT",e),r.a.createElement("div",{style:{padding:20}},r.a.createElement(v.a,{option:{tooltip:{trigger:"axis"},xAxis:{data:e.timeRange,axisTick:{alignWithLabel:!0}},axisPointer:{link:{xAxisIndex:"all"}},yAxis:{type:"value"},toolbox:{left:"center",feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},grid:{},dataZoom:[{show:!0},{type:"inside"}],series:{type:"line",data:e.dates}}}))},k=a(710),x=a(707),w=a(709),S=Object(O.a)((function(e){return{images:{},gridList:{transform:"translateZ(0)",paddingRight:20,paddingLeft:20,paddingTop:10},header:{marginBottom:0,paddingLeft:20}}})),D=function(e){var t=S(),a=e.closest.map((function(e,t){return r.a.createElement(x.a,{key:t,style:{minWidth:375}},r.a.createElement("img",{src:e.image,alt:t,style:{height:300}}),r.a.createElement(w.a,{title:e.metadata.distance}))})),n=e.farest.map((function(e,t){return r.a.createElement(x.a,{key:t,style:{minWidth:375}},r.a.createElement("img",{src:e.image,alt:t,style:{height:300}}),r.a.createElement(w.a,{title:e.metadata.distance}))}));return r.a.createElement("div",null,r.a.createElement("h2",{className:t.header},"Closest"),r.a.createElement(k.a,{className:t.gridList,cols:e.quantity||1,cellHeight:300},a),r.a.createElement("h2",{className:t.header},"Farthest"),r.a.createElement(k.a,{className:t.gridList,cols:e.quantity||1,cellHeight:300},n))},C=(a(662),a(46)),R=a(172),N=(a(663),a(715)),_=a(719),I=a(712),T=a(283),L=a.n(T);function z(e){return r.a.createElement("div",null,r.a.createElement(_.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:e.open,autoHideDuration:6e3,onClose:e.handleClose,message:"File loaded",action:r.a.createElement(r.a.Fragment,null,r.a.createElement(I.a,{size:"small","aria-label":"close",color:"inherit",onClick:e.handleClose},r.a.createElement(L.a,{fontSize:"small"})))}))}var F=a(284),U=Object(O.a)((function(e){return{root:{flexGrow:1,overflow:"hidden",padding:e.spacing(0,3)},gridItem:{padding:e.spacing(1),width:"50%"},spinner:{color:"grey",paddingLeft:10}}}));var A=function(){var e=U(),t=Object(n.useState)(""),a=Object(d.a)(t,2),c=(a[0],a[1],Object(n.useState)(null)),o=Object(d.a)(c,2),l=o[0],m=o[1],p=Object(n.useState)(null),O=Object(d.a)(p,2),j=(O[0],O[1]),v=Object(n.useState)(null),k=Object(d.a)(v,2),x=k[0],w=k[1],S=Object(n.useState)([]),_=Object(d.a)(S,2),I=_[0],T=_[1],L=Object(n.useState)([]),A=Object(d.a)(L,2),P=A[0],V=A[1],W=Object(n.useState)(!1),G=Object(d.a)(W,2),H=G[0],J=G[1],M=Object(n.useState)(3),Z=Object(d.a)(M,2),B=Z[0],q=(Z[1],Object(n.useState)(!1)),K=Object(d.a)(q,2),X=K[0],Y=K[1],$=Object(n.useState)(null),Q=Object(d.a)($,2),ee=Q[0],te=Q[1],ae=Object(n.useState)(null),ne=Object(d.a)(ae,2),re=ne[0],ce=ne[1],oe=Object(n.useState)(!1),ie=Object(d.a)(oe,2),le=ie[0],se=ie[1],ue=Object(n.useState)(.93),de=Object(d.a)(ue,2),me=de[0],pe=de[1],fe=Object(n.useState)(null),ge=Object(d.a)(fe,2),he=ge[0],be=ge[1],Ee=r.a.useState(!1),Oe=Object(d.a)(Ee,2),je=Oe[0],ve=Oe[1],ye=function(){var e=Object(u.a)(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=3;break}return alert("No file to upload"),e.abrupt("return",0);case 3:return Y(!0),console.log("Sending data"),(t=new FormData).append("token","TDlRJi8ORMGVrMedVkZDXsUDK"),t.append("action","faiss_search"),t.append("table_name","lukoshko_with_arr_norm"),t.append("index_filename","ktrk_index.faiss"),t.append("radius",me),t.append("file1",l,"image.jpg"),e.prev=12,e.next=15,fetch("https://9e94093f8750.sn.mynetname.net:5000/",{method:"POST",body:t});case 15:return a=e.sent,e.next=18,a.json();case 18:n=e.sent,j(n),console.log(n),xe(n),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(12),console.error("\u041e\u0448\u0438\u0431\u043a\u0430:",e.t0);case 27:case"end":return e.stop()}}),e,null,[[12,24]])})));return function(){return e.apply(this,arguments)}}(),ke=function(){var e=Object(u.a)(s.a.mark((function e(t){var a,n,r,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Getting image"),a=window.URL||window.webkitURL,(n=new FormData).append("token","TDlRJi8ORMGVrMedVkZDXsUDK"),n.append("action","extract_frame"),n.append("file_path",t.file_path),n.append("frame_index",t.frame_index),e.prev=7,e.next=10,fetch("https://9e94093f8750.sn.mynetname.net:5000/",{method:"POST",body:n});case 10:return r=e.sent,e.next=13,r.blob();case 13:return c=e.sent,o=a.createObjectURL(c),console.log("RESPONSE",c),e.abrupt("return",{metadata:t,image:o});case 19:e.prev=19,e.t0=e.catch(7),console.error("\u041e\u0448\u0438\u0431\u043a\u0430:",e.t0);case 22:case"end":return e.stop()}}),e,null,[[7,19]])})));return function(t){return e.apply(this,arguments)}}(),xe=function(e){var t=Object.values(e[0].metadata);console.log(t);var a=Object(i.a)(t).sort((function(e,t){return e.distance-t.distance}));w(a),we(a),Se(a)},we=function(){var e=Object(u.a)(s.a.mark((function e(t){var a,n,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.slice(t.length-B),n=t.slice(0,B),console.log("closest",a),console.log("farest",n),r=[],c=[],e.next=8,a.forEach((function(e){return ke(e).then((function(e){return r.push(e)}))}));case 8:return e.next=10,n.forEach((function(e){return ke(e).then((function(e){return c.push(e)}))}));case 10:T(r),V(c),setTimeout((function(){return Y(!1)}),2e3);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=function(e){var t=Object(C.d)("%U"),a=Object(C.d)("%Y-%m-%d %H:00"),n=e,r=Object(C.a)(n,(function(e){return t(Date.parse(e.appearance_time))}));console.log("Time extent",r);var c=Object(C.b)(r[0],r[1]).concat(r[1]);console.log(c);var o=Object(R.a)().key((function(e){return t(Date.parse(e.appearance_time))})).rollup((function(e){return Object(C.c)(e,(function(e){return 1}))})).map(n);console.log("NESTED",o);var i=Object(R.a)().key((function(e){return a(Date.parse(e.appearance_time))})).rollup((function(e){return Object(C.c)(e,(function(e){return 1}))})).map(n);console.log("HOUR NEST",i);var l=Object(C.a)(i.keys());console.log(l);var s=Object(C.e)(new Date(l[0]),new Date(l[1])).concat(new Date(l[1])).map((function(e){return a(e)})),u=c.map((function(e){return(e<10?o.get("0"+e):o.get(e))||0})),d=s.map((function(e){return i.get(e)||0})),m=i.get(s[0]);console.log(s[3]),console.log("TEST",m),console.log(u),console.log(d),te(d),ce(s)};return r.a.createElement("div",{className:"App"},r.a.createElement(g.a,{container:!0,direction:"column",alignItems:"center",justify:"center"},r.a.createElement(g.a,{container:!0,justify:"center",className:e.gridItem},r.a.createElement(f,{handleChange:function(e){console.log(e),m(e)},handleClick:function(){ve(!0)},setImage:be})),r.a.createElement(g.a,{container:!0,justify:"center",className:e.gridItem},he?r.a.createElement("img",{src:he,alt:"initial_image",style:{height:300}}):null),r.a.createElement(g.a,{container:!0,justify:"center",className:e.gridItem},r.a.createElement(h.a,{variant:"outlined",id:"radius",size:"small",label:"Radius",value:me,onChange:function(e){pe(e.target.value)}}),r.a.createElement(b.a,{variant:"contained",size:"small",onClick:function(){return ye()}},"Send Data"),r.a.createElement("div",{className:e.spinner},X?r.a.createElement(N.a,{size:32,style:{color:"grey"}}):null)),r.a.createElement(g.a,{container:!0,justify:"center",className:e.gridItem},x?r.a.createElement(F.CSVLink,{data:x,separator:"\t"},"Download TSV"):null)),r.a.createElement("div",{style:{padding:20}},r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(E.a,{variant:"h5",style:{margin:0,paddingRight:10}},"Images"),r.a.createElement(b.a,{variant:"contained",size:"small",onClick:function(){J(!H)}},"Show")),H?r.a.createElement(D,{farest:P,closest:I,quantity:B}):null),r.a.createElement("div",{style:{padding:20}},r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(E.a,{variant:"h5",style:{margin:0,paddingRight:10}},"Charts"),r.a.createElement(b.a,{variant:"contained",size:"small",onClick:function(){se(!le)}},"Show")),le?r.a.createElement(y,{timeRange:re,dates:ee}):null),r.a.createElement(z,{handleClose:function(e,t){"clickaway"!==t&&ve(!1)},open:je}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[347,1,2]]]);
//# sourceMappingURL=main.58681b39.chunk.js.map